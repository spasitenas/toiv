### MQTT и Встроенный Брокер MQTT в Wiren Board 6

#### Что такое MQTT?

**MQTT (Message Queuing Telemetry Transport)** — легковесный протокол обмена данными, оптимизированный для устройств с ограниченными ресурсами и сетей с низкой пропускной способностью, таких как IoT. Протокол реализует модель публикации-подписки и состоит из двух основных компонентов:

- **Брокер**: Центральный сервер, который обрабатывает и распределяет сообщения между клиентами.
- **Клиенты**: Устройства или приложения, подписывающиеся на топики и публикующие в них данные.

#### Что такое встроенный брокер MQTT в Wiren Board 6?

**Встроенный брокер MQTT** в контроллере Wiren Board 6 — это центральный компонент системы автоматизации, который обеспечивает обмен данными между различными датчиками, модулями и контролируемыми устройствами.

### Как используется встроенный брокер MQTT в Wiren Board 6?

1. **Централизованный обмен данными**: Все устройства и модули, подключенные к контроллеру, передают данные через брокер MQTT. Пример:
    - Модули ввода/вывода отправляют показания датчиков.
    - Модули реле получают команды на включение/выключение.

2. **Интеграция с внешними системами**: Брокер MQTT может использоваться для связи с другими системами автоматизации или сторонними облачными сервисами.

3. **Управление и мониторинг**: Вы можете управлять устройствами и получать данные, используя различные инструменты публикации/подписки.

### Примеры использования брокера MQTT в Wiren Board 6

1. **Публикация данных от датчика температуры**:
   Допустим, датчик температуры подключен к контроллеру через модуль ввода. Контроллер публикует данные в топик `wb/sensors/temperature`.

2. **Подписка на топик для управления реле**:
   Для управления реле используется топик `wb/relay/control`. Чтобы включить реле, необходимо отправить команду, подписавшись на этот топик.

### Практическое руководство по настройке и использованию встроенного брокера MQTT в Wiren Board 6

#### 1. Проверка наличия установленного брокера

В Wiren Board обычно предустановлен брокер MQTT `mosquitto`. Чтобы убедиться в этом, выполните команду:

```bash
dpkg -l | grep mosquitto
```

#### 2. Настройка брокера MQTT

Основной конфигурационный файл для брокера MQTT на Wiren Board 6 находится по пути `/etc/mosquitto/mosquitto.conf`.

Пример конфигурационного файла:

```conf
# Включение логирования
log_dest file /var/log/mosquitto/mosquitto.log

# Выбор порта
port 1883

# Отключение анонимного доступа
allow_anonymous false

# Конфигурация пользователей и паролей
password_file /etc/mosquitto/passwd
```

#### 3. Настройка пользователей и паролей

Для добавления пользователей создайте файл паролей с помощью утилиты `mosquitto_passwd`.

```bash
touch /etc/mosquitto/passwd
mosquitto_passwd -c /etc/mosquitto/passwd admin
```

Добавьте других пользователей без флага `-c`:

```bash
mosquitto_passwd /etc/mosquitto/passwd user1
mosquitto_passwd /etc/mosquitto/passwd user2
```

#### 4. Перезапуск брокера

После изменения конфигурации перезапустите брокер:

```bash
systemctl restart mosquitto
```

#### 5. Примеры использования MQTT в Wiren Board 6

- **Публикация данных**:
  Для публикации данных в MQTT-топик используйте команду `mosquitto_pub`.

  ```bash
  mosquitto_pub -h localhost -t "wb/control/relay" -m "1" -u admin -P password
  ```

  Это включает реле через топик `wb/control/relay`.

- **Подписка на топик**:
  Для подписки на топик и получения данных используйте команду `mosquitto_sub`.

  ```bash
  mosquitto_sub -h localhost -t "wb/sensors/temperature" -u admin -P password
  ```

  Эта команда позволяет получить температуру с датчика, подключенного к контроллеру.
